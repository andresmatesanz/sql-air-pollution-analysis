-- Crear columna valor_dia y calcular promedio diario de D01 a D31
ALTER TABLE t_master ADD COLUMN valor_dia FLOAT;

UPDATE t_master
SET valor_dia = ROUND(
    (COALESCE(D01,0) + COALESCE(D02,0) + COALESCE(D03,0) + COALESCE(D04,0) + COALESCE(D05,0) +
     COALESCE(D06,0) + COALESCE(D07,0) + COALESCE(D08,0) + COALESCE(D09,0) + COALESCE(D10,0) +
     COALESCE(D11,0) + COALESCE(D12,0) + COALESCE(D13,0) + COALESCE(D14,0) + COALESCE(D15,0) +
     COALESCE(D16,0) + COALESCE(D17,0) + COALESCE(D18,0) + COALESCE(D19,0) + COALESCE(D20,0) +
     COALESCE(D21,0) + COALESCE(D22,0) + COALESCE(D23,0) + COALESCE(D24,0) + COALESCE(D25,0) +
     COALESCE(D26,0) + COALESCE(D27,0) + COALESCE(D28,0) + COALESCE(D29,0) + COALESCE(D30,0) +
     COALESCE(D31,0)) / 31, 2);

-- Crear columna fecha y actualizar con formato YYYY-MM-DD
ALTER TABLE t_master ADD COLUMN FECHA DATE;

UPDATE t_master
SET FECHA = DATE_FORMAT(CONCAT(ANO, "-", MES, "-", "01"), "%Y-%m-%d");
